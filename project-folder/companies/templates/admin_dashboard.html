{% extends "base.html" %}

{% block head %}

{% load static %}

<link rel="stylesheet" type="text/css" href='{% static "/css/employee_modal.css" %}'>
<script type="text/javascript" src='{% static "/js/employee_modal.js" %}'></script>

{% endblock %}

{% block content %}
    <h2>Admin Dashboard</h2>
    {% if user.is_authenticated and "ok" in request.GET.login %}
        <p> Utente : {{user.username}}</p>
        <p> Amministratore di : {{user.related_company}}</p>

        <h3>Dipendenti</h3>

        <table>
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Rimuovi</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                    <tr>
                        <td>{{ employee.user.username }}</td>
                        <td>{{ employee.user.email }}</td>
                        <td>
                            <form method="POST" action="{% url 'remove_employee' employee.id %}">
                                {% csrf_token %}
                                <button type="submit">Rimuovi</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>


        <!-- Aggiungi Dipendente Button -->
        <button type="button" id="addEmployeeBtn">Aggiungi Dipendente</button>

        <!-- Modal -->
        <div id="addEmployeeModal" style="display:none;">
            <div>
                <span id="closeModal" style="cursor:pointer;">&times;</span>
                <h2>Employee Signup</h2>
                <form method="POST" action="{% url 'employee_signup' %}">
                    {% csrf_token %}
                    {{ employee_signup_form.userForm.as_p }}
                    <button type="submit">Signup</button>
                </form>
            </div>
        </div>

        <script>
                        // Get the modal
            var modal = document.getElementById("addEmployeeModal");

            // Get the button that opens the modal
            var btn = document.getElementById("addEmployeeBtn");

            // Get the <span> element that closes the modal
            var span = document.getElementById("closeModal");

            // When the user clicks the button, open the modal 
            btn.onclick = function() {
                modal.style.display = "block";
            }

            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        </script>

        <form method="POST" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" >Logout</button>
        </form>
    {% endif %}
{% endblock %}

